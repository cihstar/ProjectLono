<html>
<head>
<title> Simulation Rain Gauge </title>
<script src="jq.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/1.0.2/Chart.min.js"></script>
<script src="Chart.Scatter.js"></script>

<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

</head>

<body>
    <h1>Simulation Rain Gauge</h1>
    
    <h2>Register</h2>
    <p>Device ID: <input type="text" id="id" value="0"/></p>  
    <button id="register">Register!</button>
    
    <h2>Send Reading</h2>
    <p>Reading: <input type="text" id="reading"/></p>
    <p>Interval: <input type="text" id="interval" default="300"/></p>
    <p>Date Time: <input type="text" id="datetime"/></p>     
    <button id="send">Send!</button> 
    
    <h2>Reply From Server</h2>
    <p id="reply"></p>
    
    <h2>Get Reading Data from Server</h2>
    <p>Start Time: <input type="text" id="start" value="02/03/2016 00:00:00"/></p>
    <p>End Time: <input type="text" id="end" value="03/03/2016 00:00:00"/></p>
    <button id="get">Get Data!</button>
    
    <h3>ChartJS with Scatter extention</h3>
    <canvas id="myChart" width="600" height="400"></canvas>
    
    <h3>Plot.ly JS</h3>
    <div id="myDiv" style="width: 600px; height: 400px;"><!-- Plotly chart will be drawn inside this DIV --></div>
    
    
    <script type="text/javascript">
    
    var url = "http://lono-rain.appspot.com";
    //var url = "http://localhost:8082";

    var registerFun = function()
    {        
        $.post( url+"/reg", {id:$(id).val()}, function( data ) {
        $(reply).html( data ); });
    }
    
    var readingFun = function()
    {        
        $.post( url+"/send", {id:$(id).val(), reading:$(reading).val(), time:$(datetime).val(), interval:$(interval).val()}, function( data ) {
        $(reply).html( data ); });
    }
    
    var getDataFun = function()
    {        
        $.post( url+"/getDataForDeviceInRange", {id:$(id).val(), start:$(start).val(), end:$(end).val()}, 
        function( returnData ) {
            $(reply).html( returnData );
            
            var jsonData = $.parseJSON(returnData);
            var myData = [];    
            
            
            var plx = [];
            var ply = [];  
            
            for (i = 0; i < jsonData.length; i++)
            {                
                myData.push({x:Date.parse(jsonData[i].time), y:(jsonData[i].value * ((60*60) / jsonData[i].interval)) });
                
                plx.push(jsonData[i].time);
                ply.push( (jsonData[i].value * ((60*60) / jsonData[i].interval)) );                
            }
            
             var pldata = [
                {
                    x: plx,
                    y: ply,
                    type: 'scatter'
                }
            ];
            

            Plotly.newPlot('myDiv', pldata);
            
            
            var data = {datasets: [
                {
                    label: "Rainfall",
                    fillColor: "rgba(220,220,220,0.2)",
                    strokeColor: "rgba(220,220,220,1)",
                    pointColor: "rgba(220,220,220,1)",
                    pointStrokeColor: "#fff",
                    pointHighlightFill: "#fff",
                    pointHighlightStroke: "rgba(220,220,220,1)",
                    data: myData
                }]};  
            var myLineChart = new Chart(ctx).Scatter(data, {scaleType: "date", scaleDateFormat: "dd/mm/yy", scaleTimeFormat:"HH:MM", scaleDateTimeFormat: "dd mmmm yyyy HH:MM:ss"});
     });
    }
    
    $(register).click(registerFun);
    $(send).click(readingFun);
    $(get).click(getDataFun);
    
    
    var ctx = $("#myChart").get(0).getContext("2d");


</script>
    
</body>
</html>
